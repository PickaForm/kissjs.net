

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> common/formula.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
             
                <a href="index.html">
                    <h1 class="navbar-item">KissJS api documentation</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    API Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Namespaces</h3><ul><li><a href="kiss.html">kiss</a></li><li><a href="kiss.acl.html">acl</a></li><li><a href="kiss.ajax.html">ajax</a></li><li><a href="kiss.app.html">app</a></li><li><a href="kiss.context.html">context</a></li><li><a href="kiss.data.html">data</a></li><li><a href="kiss.data.trash.html">trash</a></li><li><a href="kiss.db.html">db</a></li><li><a href="kiss.db.faker.html">faker</a></li><li><a href="kiss.db.memory.html">memory</a></li><li><a href="kiss.db.mongo.html">mongo</a></li><li><a href="kiss.db.offline.html">offline</a></li><li><a href="kiss.db.online.html">online</a></li><li><a href="kiss.directory.html">directory</a></li><li><a href="kiss.formula.html">formula</a></li><li><a href="kiss.language.html">language</a></li><li><a href="kiss.loader.html">loader</a></li><li><a href="kiss.loadingSpinner.html">loadingSpinner</a></li><li><a href="kiss.logger.html">logger</a></li><li><a href="kiss.plugins.html">plugins</a></li><li><a href="kiss.pubsub.html">pubsub</a></li><li><a href="kiss.router.html">router</a></li><li><a href="kiss.screen.html">screen</a></li><li><a href="kiss.selection.html">selection</a></li><li><a href="kiss.serviceWorker.html">serviceWorker</a></li><li><a href="kiss.session.html">session</a></li><li><a href="kiss.theme.html">theme</a></li><li><a href="kiss.tools.html">tools</a></li><li><a href="kiss.ui.html">ui</a></li><li><a href="kiss.undoRedo.html">undoRedo</a></li><li><a href="kiss.ux.html">ux</a></li><li><a href="kiss.views.html">views</a></li><li><a href="kiss.websocket.html">websocket</a></li></ul><h3>Classes</h3><ul><li><a href="kiss.data.Collection.html">Collection</a></li><li><a href="kiss.data.Model.html">Model</a></li><li><a href="kiss.data.RecordFactory-Record.html">Record</a></li><li><a href="kiss.data.Transaction.html">Transaction</a></li><li><a href="kiss.ui.Attachment.html">Attachment</a></li><li><a href="kiss.ui.Block.html">Block</a></li><li><a href="kiss.ui.Button.html">Button</a></li><li><a href="kiss.ui.Checkbox.html">Checkbox</a></li><li><a href="kiss.ui.Color.html">Color</a></li><li><a href="kiss.ui.ColorPicker.html">ColorPicker</a></li><li><a href="kiss.ui.Component.html">Component</a></li><li><a href="kiss.ui.Container.html">Container</a></li><li><a href="kiss.ui.DataComponent.html">DataComponent</a></li><li><a href="kiss.ui.Datatable.html">Datatable</a></li><li><a href="kiss.ui.Dialog.html">Dialog</a></li><li><a href="kiss.ui.Field.html">Field</a></li><li><a href="kiss.ui.Html.html">Html</a></li><li><a href="kiss.ui.Icon.html">Icon</a></li><li><a href="kiss.ui.IconPicker.html">IconPicker</a></li><li><a href="kiss.ui.Image.html">Image</a></li><li><a href="kiss.ui.Menu.html">Menu</a></li><li><a href="kiss.ui.Notification.html">Notification</a></li><li><a href="kiss.ui.Panel.html">Panel</a></li><li><a href="kiss.ui.Rating.html">Rating</a></li><li><a href="kiss.ui.Select.html">Select</a></li><li><a href="kiss.ui.Slider.html">Slider</a></li><li><a href="kiss.ui.Spacer.html">Spacer</a></li><li><a href="kiss.ui.Tip.html">Tip</a></li><li><a href="kiss.ux.AiTextarea.html">AiTextarea</a></li><li><a href="kiss.ux.CodeEditor.html">CodeEditor</a></li><li><a href="kiss.ux.QrCode.html">QrCode</a></li></ul><h3>Global</h3><ul><li><a href="global.html#createAttachment">createAttachment</a></li><li><a href="global.html#createBlock">createBlock</a></li><li><a href="global.html#createButton">createButton</a></li><li><a href="global.html#createCheckbox">createCheckbox</a></li><li><a href="global.html#createCodeEditor">createCodeEditor</a></li><li><a href="global.html#createColorField">createColorField</a></li><li><a href="global.html#createColorPicker">createColorPicker</a></li><li><a href="global.html#createDatatable">createDatatable</a></li><li><a href="global.html#createDateField">createDateField</a></li><li><a href="global.html#createDialog">createDialog</a></li><li><a href="global.html#createField">createField</a></li><li><a href="global.html#createForm">createForm</a></li><li><a href="global.html#createHtml">createHtml</a></li><li><a href="global.html#createIconField">createIconField</a></li><li><a href="global.html#createIconPicker">createIconPicker</a></li><li><a href="global.html#createImage">createImage</a></li><li><a href="global.html#createMenu">createMenu</a></li><li><a href="global.html#createNotification">createNotification</a></li><li><a href="global.html#createNumberField">createNumberField</a></li><li><a href="global.html#createPanel">createPanel</a></li><li><a href="global.html#createPasswordField">createPasswordField</a></li><li><a href="global.html#createQRCode">createQRCode</a></li><li><a href="global.html#createRating">createRating</a></li><li><a href="global.html#createSelect">createSelect</a></li><li><a href="global.html#createSlider">createSlider</a></li><li><a href="global.html#createTextareaField">createTextareaField</a></li><li><a href="global.html#createTextField">createTextField</a></li><li><a href="global.html#createTip">createTip</a></li><li><a href="global.html#generateBreadcrumb">generateBreadcrumb</a></li><li><a href="global.html#generateSlug">generateSlug</a></li><li><a href="global.html#isNumericField">isNumericField</a></li><li><a href="global.html#regex">regex</a></li><li><a href="global.html#validateNumber">validateNumber</a></li><li><a href="global.html#validateText">validateText</a></li><li><a href="global.html#validateTextLength">validateTextLength</a></li><li><a href="global.html#validateValue">validateValue</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>common/formula.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * 
 * ## Formula module
 * 
 * **Handle specific formulae that can be used inside computed fields.**
 * 
 * @namespace
 */
kiss.formula = {
    /**
     * Generates a short id
     * 
     * @returns {string}
     * 
     * @example
     * SHORT_ID() // "A84F007X"
     */    
    SHORT_ID: () => kiss.tools.shortUid().toUpperCase(),

    /**
     * SUM
     * 
     * @param  {...any} numbers 
     * @returns {number}
     * 
     * @example
     * SUM(1, 2, 3) // 6
     */
    SUM: (...numbers) => numbers.reduce((a, b) => Number(a||0) + Number(b||0), 0),

    /**
     * COUNT the number of items passed as parameters
     * 
     * @param  {...any} items
     * @returns {number}
     * 
     * @example
     * COUNT(1, "B", "C", 7) // 4
     */
    COUNT: (...items) => {
        return items.length
    },

    /**
     * COUNT the number of non-empty items passed as parameters
     * 
     * @param  {...any} items
     * @returns {number}
     * 
     * @example
     * COUNT_NON_EMPTY(1, "B", "C", 7, "", []) // 4
     */
    COUNT_NON_EMPTY: (...items) => {
        const nonEmpty = items.filter(item => {
            return (item !== undefined) &amp;&amp; (item !== "") || (Array.isArray(item) &amp;&amp; item.length != 0)
        })
        return nonEmpty.length
    },

    /**
     * COUNT the number of empty items passed as parameters
     * 
     * @param  {...any} items
     * @returns {number}
     * 
     * @example
     * COUNT_EMPTY(1, "B", "C", 7, "", []) // 2
     */
    COUNT_EMPTY: (...items) => {
        const empty = items.filter(item => {
            return (item === undefined) || (item === "") || (Array.isArray(item) &amp;&amp; item.length == 0)
        })
        return empty.length
    },        

    /**
     * MIN
     * @param  {...any} numbers 
     * @returns {number}
     * 
     * @example
     * MIN(42, 666, 1515, 7) // 7
     */
    MIN: (...numbers) => Math.min(...numbers),

    /**
     * MAX
     * 
     * @param  {...any} numbers 
     * @returns {number}
     * 
     * @example
     * MAX(42, 666, 1515, 7) // 1515
     */
    MAX: (...numbers) => Math.max(...numbers),

    /**
     * AVERAGE
     * 
     * @param  {...any} numbers 
     * @returns {number}
     * 
     * @example
     * AVERAGE(10, 20, 30) // 20
     */
    AVERAGE: (...numbers) => kiss.formula.SUM(...numbers) / numbers.length,

    /**
     * ROUND
     * 
     * @param {number} number 
     * @param {number} precision 
     * @returns {number}
     * 
     * @example
     * ROUND(12.367891, 3) // 12.378
     */
    ROUND: (number, precision) => number.round(precision),

    /**
     * Returns the square root of a number
     * 
     * @param {number} number 
     * @returns {number}
     * 
     * @example
     * SQRT(16) // 4
     */
    SQRT: (number) => Math.sqrt(number),

    /**
     * PI
     * 
     * @returns {number}
     * 
     * @example
     * PI() // 3.1415927...
     */    
    PI: () => Math.PI,

    /**
     * Returns the COSINUS of a number
     * 
     * @param {number} number 
     * @returns {number}
     * 
     * @example
     * COS(2 * PI()) // 1
     */    
    COS: (number) => Math.cos(number),

    /**
     * Returns the SINUS of a number
     * 
     * @param {number} number 
     * @returns {number}
     * 
     * @example
     * SIN(PI() / 2) // 1
     */      
    SIN: (number) => Math.sin(number),

    /**
     * Returns the TANGENT of a number
     * 
     * @param {number} number 
     * @returns {number}
     * 
     * @example
     * TAN(PI() / 4) // 1
     */    
    TAN: (number) => Math.tan(number),

    /**
     * Returns the left part of a string
     * 
     * @param {string} text
     * @param {number} n
     * @returns {text}
     * 
     * @example
     * LEFT("San Francisco", 3) // San
     */         
    LEFT: (text, n) => (n > 0) ? text.slice(0, n) : "",

    /**
     * Returns the right part of a string
     * 
     * @param {string} text
     * @param {number} n
     * @returns {text}
     * 
     * @example
     * RIGHT("San Francisco", 9) // Francisco
     */        
    RIGHT: (text, n) => (n > 0) ? text.slice(-n) : "",

    /**
     * Returns the middle part of a string
     * 
     * @param {string} text
     * @param {number} n
     * @returns {text}
     * 
     * @example
     * MIDDLE("San Francisco", 4, 8) // Fran
     */      
    MIDDLE: (text, from, to) => text.slice(from, to),

    /**
     * Returns the left part of a string, given a separator
     * 
     * @param {string} text
     * @param {string} separator
     * @returns {text}
     * 
     * @example
     * STRLEFT("San Francisco", " ") // San
     */
    STRLEFT: (text, separator) => text.split(separator)[0],

    /**
     * Returns the right part of a string, given a separator
     * 
     * @param {string} text
     * @param {string} separator
     * @returns {text}
     * 
     * @example
     * STRRIGHT("San Francisco", " ") // Francisco
     */       
    STRRIGHT: (text, separator) => text.split(separator).pop(),

    /**
     * Convert a string to uppercase
     * 
     * @param {string} text
     * @returns {text}
     * 
     * @example
     * UPPERCASE("San Francisco") // SAN FRANCISCO
     */    
    UPPERCASE: (text) => text.toUpperCase(),

    /**
     * Convert a string to lowercase
     * 
     * @param {string} text
     * @returns {text}
     * 
     * @example
     * LOWERCASE("San Francisco") // san francisco
     */     
    LOWERCASE: (text) => text.toLowerCase(),

    /**
     * Convert a string to titlecase
     * 
     * @param {string} text
     * @returns {text}
     * 
     * @example
     * TITLECASE("paris") // Paris
     */      
    TITLECASE: (text) => text.toTitleCase(),

    /**
     * Replace a string inside another string
     * 
     * @param {string} text
     * @param {string} oldText
     * @param {string} newText
     * @returns {text}
     * 
     * @example
     * REPLACE("New York is great", "New York", "Paris") // Paris is great
     */    
    REPLACE: (text, oldText, newText) => text.replaceAll(oldText, newText),

    /**
     * Generates a slug from a plain title
     * 
     * @param {string} title 
     * @returns {string} The generated slug
     * 
     * @example
     * SLUG("My article about dogs") // Returns "my-article-about-dogs"
     */
    SLUG: (text) => kiss.tools.generateSlug(text),

    /**
     * Concatenate any number of strings
     * 
     * @param  {...any} strings 
     * @returns {string}
     * 
     * @example
     * CONCATENATE("Bob", " ", "Wilson") // "Bob Wilson"
     */
    CONCATENATE: (...strings) => strings.join(""),

    /**
     * Concatenate any number of strings as a comma separated text
     * 
     * @param  {...any} strings 
     * @returns {string}
     * 
     * @example
     * LIST("John", "Bob", "Steve") // "John, Bob, Steve"
     */    
    LIST: (...strings) => strings.filter(string => string !== undefined &amp;&amp; string != "").unique().join(", "),

    /**
     * Epxlode a list of names into an array of names
     * 
     * @param  {...string} names
     * @returns {string[]}
     * 
     * @example
     * LIST_NAMES("John", "Bob", "Steve") // ["John, Bob, Steve"]
     */    
    LIST_NAMES: (...names) => {
        return names.filter(name => name !== undefined &amp;&amp; name != "").flat().unique()
    },

    /**
     * Check if a string contains a value
     * 
     * @param {string} string 
     * @param {string} value 
     * @returns {boolean}
     * 
     * @example
     * CONTAINS("San Francisco", "San") // true
     * CONTAINS("Paris", "San") // false
     */
    CONTAINS: (string, value) => string.includes(value),

    /**
     * Split a string into an array of strings, given a separator
     * 
     * @param {string} text 
     * @param {string} separator
     * @returns {string[]} The resulting array of strings
     * 
     * @example
     * SPLIT("Paris,San Diego,Ajaccio", ",") // ["Paris", "San Diego", "Ajaccio"]
     */
    SPLIT: (text, separator) => text.split(separator),

    /**
     * Join an array of strings into a single string, given a separator
     * 
     * @param {string[]} array
     * @param {string} separator
     * @returns {string} The resulting string
     * 
     * @example
     * JOIN(["Paris", "San Diego", "Ajaccio"], " &amp; ") // "Paris &amp; San Diego &amp; Ajaccio"
     */
    JOIN: (array, separator) => array.join(separator),

    /**
     * Get the YEAR of an ISO date
     * 
     * @param {string} strDateISO 
     * @returns {string}
     * 
     * @example
     * YEAR("2022-12-24") // "2022"
     */
    YEAR: (strDateISO) => strDateISO.substring(0, 4),

    /**
     * Get the MONTH of an ISO date
     * 
     * @param {string} strDateISO 
     * @returns {string}
     * 
     * @example
     * MONTH("2022-12-24") // "12"
     */    
    MONTH: (strDateISO) => strDateISO.substring(5, 7),

    /**
     * Get the DAY of an ISO date
     * 
     * @param {string} strDateISO 
     * @returns {string}
     * 
     * @example
     * DAY("2022-12-24") // "24"
     */    
    DAY: (strDateISO) => strDateISO.substring(8, 10),

    /**
     * Get the YEAR and MONTH of an ISO date
     * 
     * @param {string} strDateISO 
     * @returns {string} The year
     * 
     * @example
     * YEAR_MONTH("2022-12-24") // "2022-12"
     */    
    YEAR_MONTH: (strDateISO) => strDateISO.substring(0, 7),

    /**
     * Get the current date as an ISO date string
     * 
     * @param {string} strDateISO 
     * @returns {string}
     * 
     * @example
     * TODAY() // "2022-12-24"
     */    
    TODAY: () => (new Date()).toISO(),

    /**
     * Get the current time as an ISO string (without time shift)
     * 
     * @returns {string}
     * 
     * @example
     * TIME() // "14:53:28"
     */    
    TIME: () => (new Date()).toISOString().substring(11,16),

    /**
     * Get the current date and time as a simple readable string (without time shift)
     * 
     * @returns {string}
     * 
     * @example
     * NOW() // "2022-12-24 14:53:28"
     */    
    NOW: () => (new Date()).toISOString().substring(0,19).replace("T", " "),

    /**
     * Compute the time difference between 2 dates
     * 
     * @param {string} fromISODate 
     * @param {string} toISODate
     * @param {string} unit - "d" for days, "h" for hours... "mn", "s", "ms"
     * @returns {integer} Time diffence in the required unit of time
     * 
     * @example
     * TIME_DIFFERENCE("2023-02-14T15:44:05.886Z", "2023-02-14T18:44:26.316Z", "h") // 4
     */
    TIME_DIFFERENCE: (fromISODate, toISODate, unit = "d") => {
        try {
            const fromDate = new Date(fromISODate)
            const toDate = new Date(toISODate)

            let coef
            switch(unit) {
                case "d":
                    coef = 1000 * 60 * 60 * 24
                    break
                case "h":
                    coef = 1000 * 60 * 60
                    break
                case "mn":
                    coef = 1000 * 60
                    break
                case "s":
                    coef = 1000
                case "ms":
                    coef = 1
            }
            return Math.round((toDate.getTime() - fromDate.getTime()) / coef)
        } catch (err) {
            return 0
        }
    },

    /**
     * Compute the number of days between 2 dates
     * 
     * @param {string} fromISODate
     * @param {string} toISODate 
     * @returns {integer} Number of days
     * 
     * @example
     * DAYS_DIFFERENCE("2023-01-01T15:44:05.886Z", "2023-01-15T18:44:26.316Z") // 15
     */
    DAYS_DIFFERENCE: (fromISODate, toISODate) => {
        return kiss.formula.TIME_DIFFERENCE(fromISODate, toISODate, "d")
    },

    /**
     * Compute the number of hours between 2 dates
     * 
     * @param {string} fromISODate 
     * @param {string} toISODate 
     * @returns {integer} Number of hours
     */
    HOURS_DIFFERENCE: (fromISODate, toISODate) => {
        return kiss.formula.TIME_DIFFERENCE(fromISODate, toISODate, "h")
    },  

    /**
     * Adjust a date
     * 
     * @param {Date} date 
     * @param {number} [years]
     * @param {number} [months]
     * @param {number} [days]
     * @param {number} [hours]
     * @param {number} [minutes]
     * @param {number} [seconds]
     * @returns The adjusted date
     * 
     * @example
     * let originalDate = new Date(2020, 11, 31) // December 31, 2020
     * let adjustedDate1 = ADJUST_DATE(originalDate, 0, 1, 0) // January 31, 2021
     */
    ADJUST_DATE(date, years=0, months=0, days=0, hours=0, minutes=0, seconds=0) {
        // Create a new date object by cloning the original date
        let newDate = (date) ? new Date(date) : new Date()
        
        // Add or subtract the specified number of years, months, and days
        newDate.setFullYear(newDate.getFullYear() + years)
        newDate.setMonth(newDate.getMonth() + months)
        newDate.setDate(newDate.getDate() + days)
        newDate.setHours(newDate.getHours() + hours)
        newDate.setMinutes(newDate.getMinutes() + minutes)
        newDate.setSeconds(newDate.getSeconds() + seconds)
        
        // Return the adjusted date
        return newDate
    },

    /**
     * Test a set of conditions, and returns the value of the first expression that matches the test.
     * If no condition matches, returns the value of the last (default) expression.
     * Always has an odd number of parameters:
     * 
     * ```
     *  IF(&lt;condition 1>, &lt;expression 1>, ..., ..., &lt;condition N>, &lt;expression N>, &lt;expression Else>)
     * ```
     * 
     * @param  {...any} params 
     * @returns {any} Value of the first expression that matches the condition
     * 
     * @example
     * // Returns "Good" if the field "amount" = 65, or "Poort" if the field "amout" = 20
     * IF({{amount}} > 80, "Great", {{amount}} > 60, "Good", {{amount}} > 40, "Not bad", "Poor")
     */
    IF: (...params) => {
        try {
            if (params.length &lt; 3 || params.length % 2 == 0) return false
            for (let i = 0; i &lt;= params.length - 2; i = i + 2) {
                if (params[i] == true) return params[i + 1]
            }
            return params[params.length - 1]
        } catch (err) {
            return false
        }
    }
}

;</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by 
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

</body>
</html>
